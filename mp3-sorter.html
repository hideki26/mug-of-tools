<!DOCTYPE html>
<html lang="es">
<head>
    <!-- Configuración básica del documento HTML -->
    <meta charset="UTF-8"> <!-- Define la codificación de caracteres como UTF-8 -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0"> <!-- Hace que la página sea responsive -->
    <title>Ordenador MP3 con Drag & Drop Visual</title> <!-- Título de la página -->
    
    <!-- Estilos CSS para la aplicación -->
    <style>
        /* Estilo general del cuerpo de la página */
        body {
            font-family: Arial, sans-serif; /* Fuente principal */
            max-width: 800px; /* Ancho máximo del contenido */
            margin: 0 auto; /* Centrar el contenido horizontalmente */
            padding: 20px; /* Espaciado interno */
            background-color: #f5f5f5; /* Color de fondo */
        }
        
        /* Estilo de la zona donde se arrastran los archivos */
        #drop-zone {
            border: 2px dashed #ccc; /* Borde punteado gris */
            padding: 20px; /* Espaciado interno */
            text-align: center; /* Centrar el texto */
            margin-bottom: 20px; /* Margen inferior */
            background-color: #fff; /* Fondo blanco */
            transition: all 0.3s; /* Transición suave para animaciones */
        }
        
        /* Estilo cuando la zona de arrastre está activa */
        #drop-zone.highlight {
            border-color: #4CAF50; /* Cambia el color del borde a verde */
            background-color: #e8f5e9; /* Cambia el fondo a verde claro */
        }
        
        /* Estilo de la lista de archivos */
        #file-list {
            list-style: none; /* Quita los bullets de la lista */
            padding: 0; /* Quita el padding por defecto */
        }
        
        /* Estilo de cada elemento de la lista */
        #file-list li {
            padding: 12px; /* Espaciado interno */
            margin: 8px 0; /* Margen superior e inferior */
            background-color: #fff; /* Fondo blanco */
            border: 1px solid #ddd; /* Borde gris claro */
            border-left: 4px solid #4CAF50; /* Borde izquierdo verde */
            cursor: move; /* Cursor que indica que se puede mover */
            display: flex; /* Usa flexbox para alinear elementos */
            align-items: center; /* Centra los elementos verticalmente */
            transition: all 0.3s ease; /* Transición suave para animaciones */
            box-shadow: 0 2px 4px rgba(0,0,0,0.1); /* Sombra sutil */
        }
        
        /* Efecto al pasar el mouse sobre un elemento */
        #file-list li:hover {
            background-color: #f0f0f0; /* Cambia el fondo a gris claro */
            transform: translateX(5px); /* Mueve ligeramente a la derecha */
        }
        
        /* Estilo cuando un elemento está siendo arrastrado */
        #file-list li.dragging {
            opacity: 0.5; /* Hace el elemento semi-transparente */
            background-color: #e3f2fd; /* Cambia el fondo a azul claro */
            border-left-color: #2196F3; /* Cambia el borde izquierdo a azul */
        }
        
        /* Estilo del badge que muestra la posición */
        .position-badge {
            display: inline-block; /* Hace que se comporte como bloque */
            width: 30px; /* Ancho fijo */
            height: 30px; /* Alto fijo */
            background-color: #4CAF50; /* Fondo verde */
            color: white; /* Texto blanco */
            border-radius: 50%; /* Forma circular */
            text-align: center; /* Centra el texto */
            line-height: 30px; /* Centra verticalmente el texto */
            margin-right: 12px; /* Margen a la derecha */
            font-weight: bold; /* Texto en negrita */
            flex-shrink: 0; /* Evita que se encoja */
        }
        
        /* Estilo del nombre del archivo */
        .file-name {
            flex-grow: 1; /* Ocupa todo el espacio disponible */
        }
        
        /* Estilo de los botones */
        button {
            padding: 10px 15px; /* Espaciado interno */
            margin: 10px 5px; /* Margen exterior */
            background-color: #4CAF50; /* Fondo verde */
            color: white; /* Texto blanco */
            border: none; /* Sin borde */
            cursor: pointer; /* Cursor tipo puntero */
            border-radius: 4px; /* Bordes redondeados */
            transition: background 0.3s; /* Transición suave para el fondo */
        }
        
        /* Efecto al pasar el mouse sobre un botón */
        button:hover {
            background-color: #45a049; /* Fondo verde más oscuro */
        }
    </style>
</head>
<body>
  <iframe src="header.html" style="width:100%; border:none;"></iframe>

    <!-- Título principal de la aplicación -->
    <h2>Ordenador MP3 con Posiciones Visuales</h2>
    
    <!-- Zona donde se arrastran los archivos -->
    <div id="drop-zone">
        <p>Arrastra aquí carpetas o archivos MP3</p>
    </div>
    
    <!-- Lista donde se mostrarán los archivos MP3 -->
    <ul id="file-list"></ul>
    
    <!-- Botones de acción -->
    <button id="export-m3u">Exportar como .m3u</button>
    <button id="rename-files">Renombrar con números (01_, 02_)</button>

    <!-- Código JavaScript que hace funcionar la aplicación -->
    <script>
        // Obtener referencias a los elementos principales del DOM
        const dropZone = document.getElementById('drop-zone'); // Zona de arrastre
        const fileList = document.getElementById('file-list'); // Lista de archivos
        
        // Variables de estado de la aplicación
        let mp3Files = []; // Array para almacenar los archivos MP3
        let draggedItem = null; // Referencia al elemento que se está arrastrando

        // ==============================================
        // MANEJO DE DRAG & DROP (Arrastrar y Soltar)
        // ==============================================

        // Evento cuando un archivo se arrastra SOBRE la zona de drop
        dropZone.addEventListener('dragover', (e) => {
            e.preventDefault(); // Previene el comportamiento por defecto
            dropZone.classList.add('highlight'); // Resalta la zona de drop
        });

        // Evento cuando el archivo SALE de la zona de drop
        dropZone.addEventListener('dragleave', () => {
            dropZone.classList.remove('highlight'); // Quita el resaltado
        });

        // Evento cuando se SUELTA el archivo en la zona de drop
        dropZone.addEventListener('drop', (e) => {
            e.preventDefault(); // Previene el comportamiento por defecto (abrir el archivo)
            dropZone.classList.remove('highlight'); // Quita el resaltado
            
            // Convertir los archivos a un array y procesarlos
            const files = Array.from(e.dataTransfer.files);
            mp3Files = []; // Reinicia el array de archivos
            fileList.innerHTML = ''; // Limpia la lista visual

            // Filtrar solo archivos MP3
            files.forEach(file => {
                if (file.name.toLowerCase().endsWith('.mp3')) {
                    mp3Files.push({
                        name: file.name, // Nombre del archivo
                        path: file.name, // Ruta (en este caso simple, solo el nombre)
                        file: file // Objeto File completo
                    });
                }
            });

            // Mostrar mensaje si no hay archivos MP3
            if (mp3Files.length === 0) {
                alert('No se encontraron archivos MP3. Arrastra archivos .mp3 o carpetas que los contengan.');
            } else {
                renderFileList(); // Mostrar la lista de archivos
            }
        });

        // ==============================================
        // FUNCIÓN PARA MOSTRAR LA LISTA DE ARCHIVOS
        // ==============================================
        function renderFileList() {
            fileList.innerHTML = ''; // Limpiar la lista existente
            
            // Crear un elemento de lista por cada archivo MP3
            mp3Files.forEach((file, index) => {
                const li = document.createElement('li'); // Crear elemento <li>
                li.draggable = true; // Hacer que sea arrastrable
                li.dataset.index = index; // Guardar el índice como atributo
                
                // Crear el badge que muestra la posición (número)
                const positionBadge = document.createElement('div');
                positionBadge.className = 'position-badge';
                positionBadge.textContent = index + 1; // Mostrar posición (1-based)
                
                // Crear el elemento que muestra el nombre del archivo
                const fileName = document.createElement('div');
                fileName.className = 'file-name';
                fileName.textContent = file.name;
                
                // Añadir los elementos al <li>
                li.appendChild(positionBadge);
                li.appendChild(fileName);
                
                // ==============================================
                // EVENTOS PARA EL DRAG & DROP DE ELEMENTOS
                // ==============================================
                
                // Evento cuando comienza a arrastrar un elemento
                li.addEventListener('dragstart', (e) => {
                    draggedItem = li; // Guardar referencia al elemento arrastrado
                    li.classList.add('dragging'); // Aplicar clase de estilo
                    e.dataTransfer.setData('text/plain', index); // Guardar el índice
                    setTimeout(() => li.style.opacity = '0.4', 0); // Hacerlo semi-transparente
                });

                // Evento cuando termina de arrastrar un elemento
                li.addEventListener('dragend', () => {
                    li.classList.remove('dragging'); // Quitar clase de estilo
                    li.style.opacity = '1'; // Restaurar opacidad
                    draggedItem = null; // Limpiar referencia
                });

                // Evento cuando un elemento se arrastra sobre otro
                li.addEventListener('dragover', (e) => {
                    e.preventDefault(); // Permitir el drop
                    
                    // Solo actuar si hay un elemento siendo arrastrado y no es el mismo
                    if (draggedItem && draggedItem !== li) {
                        // Calcular la posición vertical del elemento actual
                        const rect = li.getBoundingClientRect();
                        const midY = rect.top + rect.height / 2;
                        
                        // Decidir si insertar antes o después según la posición del mouse
                        if (e.clientY < midY) {
                            fileList.insertBefore(draggedItem, li); // Insertar antes
                        } else {
                            fileList.insertBefore(draggedItem, li.nextSibling); // Insertar después
                        }
                        
                        updatePositions(); // Actualizar los números de posición
                    }
                });

                // Añadir el elemento <li> a la lista
                fileList.appendChild(li);
            });
        }

        // ==============================================
        // FUNCIÓN PARA ACTUALIZAR LAS POSICIONES NUMÉRICAS
        // ==============================================
        function updatePositions() {
            // Obtener todos los elementos <li> de la lista
            const items = fileList.querySelectorAll('li');
            
            // Actualizar cada elemento
            items.forEach((item, index) => {
                const badge = item.querySelector('.position-badge');
                badge.textContent = index + 1; // Actualizar el número (1-based)
                
                // Reordenar el array mp3Files según la nueva posición
                mp3Files[index] = mp3Files[parseInt(item.dataset.index)];
                
                // Actualizar el índice almacenado en el elemento
                item.dataset.index = index;
            });
        }

        // ==============================================
        // EXPORTAR A ARCHIVO .M3U (Playlist)
        // ==============================================
        document.getElementById('export-m3u').addEventListener('click', () => {
            // Verificar que hay archivos para exportar
            if (mp3Files.length === 0) {
                alert('No hay archivos MP3 para exportar.');
                return;
            }
            
            // Crear contenido del archivo M3U
            let m3uContent = '#EXTM3U\n'; // Cabecera estándar de M3U
            
            // Añadir cada archivo al contenido
            mp3Files.forEach(file => {
                m3uContent += file.path + '\n';
            });
            
            // Crear un blob (archivo virtual) con el contenido
            const blob = new Blob([m3uContent], { type: 'text/plain' });
            
            // Crear una URL para descargar el blob
            const url = URL.createObjectURL(blob);
            
            // Crear un enlace <a> invisible para forzar la descarga
            const a = document.createElement('a');
            a.href = url;
            a.download = 'playlist.m3u'; // Nombre del archivo a descargar
            a.click(); // Simular click en el enlace
            
            // Liberar memoria
            URL.revokeObjectURL(url);
        });

        // ==============================================
        // RENOMBRAR ARCHIVOS CON PREFIJOS NUMÉRICOS
        // ==============================================
        document.getElementById('rename-files').addEventListener('click', () => {
            // Verificar que hay archivos para renombrar
            if (mp3Files.length === 0) {
                alert('No hay archivos MP3 para renombrar.');
                return;
            }
            
            // Crear contenido con las instrucciones de renombrado
            let renameInstructions = '';
            
            // Generar instrucciones para cada archivo
            mp3Files.forEach((file, index) => {
                // Crear nuevo nombre con prefijo de 2 dígitos (01_, 02_, etc.)
                const newName = `${String(index + 1).padStart(2, '0')}_${file.name}`;
                renameInstructions += `Renombrar: "${file.name}" → "${newName}"\n`;
            });
            
            // Crear un blob con las instrucciones
            const blob = new Blob([renameInstructions], { type: 'text/plain' });
            
            // Crear URL para descargar el blob
            const url = URL.createObjectURL(blob);
            
            // Crear enlace <a> invisible para forzar la descarga
            const a = document.createElement('a');
            a.href = url;
            a.download = 'instrucciones-renombrado.txt'; // Nombre del archivo
            a.click(); // Simular click
            
            // Liberar memoria
            URL.revokeObjectURL(url);
            
            // Mostrar mensaje al usuario
            alert('Instrucciones de renombrado descargadas. Consulta el archivo .txt.');
        });
    </script>
</body>
</html>